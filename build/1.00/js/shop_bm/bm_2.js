/*
 * Build by xuelei.kong@autostreets.com
 * Date: 2016-04-07 10:30:42
 * Version: 1.00
 */
function isMatchOrgan(a){bm_api.call(maintenancePort.isMatchOrgan,getIsMatchOrgan,{scviSid:scviSid,orgSid:a})}function packageList(a){bm_api.call(maintenancePort.packageList,getpackageList,{scviSid:scviSid,orgSid:a,current:current,lat:1,lng:2})}function consultantList(){bm_api.call(maintenancePort.consultantList,getConsultantList,{scviSid:scviSid,sortType:currentSortTypeVal,lat:lat,lng:lng,province:currentProvince,city:currentCity,memberSid:memberSid,current:current})}function searchShop(a){bm_api.call(maintenancePort.organList,getOrganList,{name:a})}function searchConsultant(a){bm_api.call(maintenancePort.consultantList,getConsultantList,{name:a})}function sele_consultant(a){bm_api.call(maintenancePort.consultantList,seleConsultant,{orgSid:a,current:current,scviSid:scviSid})}function autoSeleCon(a,t){bm_api.call(maintenancePort.consultantList,autoSele,{orgSid:a,bookingTime:t})}function consultantDetail(a){bm_api.call(maintenancePort.consultantDetail,getConsultantDetail,{consultSid:a,scviSid:scviSid})}function consultantDetail2(a){bm_api.call(maintenancePort.consultantDetail,getConsultantDetail2,{consultSid:a,scviSid:scviSid})}function maintenItems(a){var t=JSON.parse(sessionStorage.scviSid);bm_api.call(maintenancePort.maintenItems,getMaintenItem,{scviSid:t,distance:a})}function packageDetail(a){function t(a){var t=a.data,i="";i+='<li><p id="'+t.id+'">'+t.name+'</p><i>¥<span data-oldPrice="'+t.originalPrice+'">'+t.packagePrice+"</span></i></li>",$(".discount").append(i),priceAmount(),$(".booking_time a").attr("href","bm_time.html?orgSid="+t.store.orgSid)}bm_api.call(maintenancePort.packageDetail,t,{id:a})}function organList(){bm_api.call(maintenancePort.organList,getOrganList,{scviSid:scviSid,sortType:currentSortTypeVal,lat:lat,lng:lng,province:currentProvince,city:currentCity,current:current})}function orderConfirm(a,t,i,n,s,e,l){bm_api.call(maintenancePort.orderConfirm,getOrderConfirm,{type:a,maintainSid:t,consultantSid:i,customerName:n,customerCellphone:s,appointmentTime:e,memberSid:l})}function couponList(a,t){bm_api.call(maintenancePort.couponList,getCouponList,{memberSid:a,status:t,current:current})}function schedules(a,t){bm_api.call(maintenancePort.schedules,getSchedules,{orgSid:a,consultantSid:t})}function starShow(a,t,i){var n,s=100*a,e=Math.floor(a),l=s.toString(),c=l.substr(1,2);n=i?t.children("li").eq(i).find(".comment").children("li"):t.find(".comment").children("li");for(var o=0;e>o;o++)n.eq(o).find(".star_fill").css("width","100%");n.eq(e).find(".star_fill").css("width",c+"%")}function popup(a){$(".error_txt").text(a),$(".error_layer").show(),$("#tipbg").show()}function popdown(){$(".error_layer").hide(),$("#tipbg").hide()}function mobile(a){var t=/^0?(13[0-9]|15[0-9]|18[0-9]|14[0-9]|17[0-9])[0-9]{8}$/;return t.exec(a)?!1:!0}function dateTrans(a){var t,a;return a.substr(9,2).indexOf("_")>0?(t="0"+a.substr(9,1),a=a.substr(11,2).length>1?a.substr(11,2):"0"+a.substr(11,2)):(t=a.substr(9,2),a=a.substr(12,2).length>1?a.substr(12,2):"0"+a.substr(12,2)),t+"-"+a}function priceAmount(){{var a=0,t=0;$(".discount>li").length}1==$(".discount li").length?(a=$(".discount li").eq(0).children("i").children("span").attr("data-oldprice"),t=$(".discount li").eq(0).children("i").children("span").text()):$(".discount li").each(function(){a+=parseInt($(this).children("i").children("span").attr("data-oldprice")),t+=parseInt($(this).children("i").children("span").text())}),$(".confirm_pay .old").text(a),$(".confirm_pay .new").text("¥"+t)}var starDom='<ul class="comment"><li class="one"><span class="star_fill"></span><span class="star_blank"></span></li><li class="two"><span class="star_fill"></span><span class="star_blank"></span></li><li class="three"><span class="star_fill"></span><span class="star_blank"></span></li><li class="four"><span class="star_fill"></span><span class="star_blank"></span></li><li class="five"><span class="star_fill"></span><span class="star_blank"></span></li></ul>';maintenancePort.consultantList=sitUrl+"consultant/list",maintenancePort.consultantDetail=sitUrl+"consultant/detail",maintenancePort.maintenItems=sitUrl+"mainten/items",maintenancePort.organList=sitUrl+"maintainOrganization/list",maintenancePort.orderConfirm=sitUrl+"maintainOrder/orderConfirm",maintenancePort.couponList=sitUrl+"coupon/list",maintenancePort.schedules=sitUrl+"maintainOrganization/findWorkSchedules",maintenancePort.packageList=sitUrl+"maintenPackage/list",maintenancePort.packageDetail=sitUrl+"maintenPackage/detail",maintenancePort.isMatchOrgan=sitUrl+"maintainOrganization/isMatchOrgan",$("#consultant_list").length&&scrollLoading(consultantList),$("#consultant_list2").length&&scrollLoading(consultantList);var autoSele=function(a){var t,i,n=a.data;$.each(n,function(a,n){return t=n.name,i=n.id,!1}),$(".con_name").text(t),$(".con_name").attr("id",i)},seleConsultant=function(a){var t=$("#consultant_list2"),i=a.data,n="";i.length||isNotEmptyObj(a.data)?($.each(i,function(a,i){var s=i.isServiced?'<img class="hot" src="http://img.autostreetscdn.com/m/build/1.00/images/booking_maintenance/heart.png" alt=""><i class="select"></i>':'<i class="unselect"></i>';n="<li>"+s+'<img src="'+imgUrl+i.photoUrl+'" class="conlist_img"/><h3 id="'+i.id+'">'+i.name+"</h3>"+starDom+'<p class="title">'+i.jobTitle+'</p><p class="year">工作年限：'+i.workAge+'年</p><p class="shop">所属门店：'+i.orgNameAbbr+"</p></li>",t.append(n),i.score&&starShow(i.score,t,a)}),$("#consultant_list2 li").each(function(){var a=$("#consultant_list2 li").index(this);0!=a&&$(this).children("i").removeClass("select").addClass("unselect")})):(n='<li class="nodata">抱歉，没有符合条件的顾问</li>',t.append(n))},getConsultantDetail2=function(a){var t=a.data;$(".con_name").text(t.name),$(".con_name").attr("id",t.id)};$("#shop_list").length&&scrollLoading(organList);var getIsMatchOrgan=function(a){var t=a.data;if(t||""!=msg){var i=request(),n=$(".go_shop").attr("id");window.location.href="bm_maintain.html?consultSid="+i.consultSid+"&orgSid="+n}else popup("您的爱车品牌不在该顾问服务范围内，请选择其他顾问")},getSchedules=function(a){var t=a.data,i="",n="",s="",e=$("#scroller ul"),l=$(".schedules");$.each(t,function(a,t){i="<li><h4>"+t.dateDesc+'</h4><p id="'+dateChange(t.date).substr(0,10)+'">'+dateChange(t.date).substr(5,5)+"</p></li>",e.append(i),n='<ul class="time_list" id="time_list_'+a+'"></ul>',l.append(n),$.each(t.workScheduleList,function(a,t){var i=t.discount?"<span>"+t.discount+"折</span>":"",n=1==t.status?' class="none"':"";s+="<li"+n+"><p>"+t.serviceTime+"</p>"+i+"</li>"}),$("#time_list_"+a).append(s),s=""}),$("#scroller>ul>li").eq(0).addClass("cur"),$("ul.time_list").eq(0).show();var c,o=request();c=new IScroll("#wrapper",{eventPassthrough:!0,scrollX:!0,scrollY:!1,preventDefault:!1});var r=$("#scroller>ul>li");(o.date||o.time)&&r.each(function(){if($(this).children("p").attr("id")==o.date){var a=r.index(this);c.scrollToElement(r.eq(a)[0],1e3),r.eq(a).click(),$("#time_list_"+a+">li").each(function(){$(this).children("p").text()==o.time&&$(this).addClass("cur")})}})},getCouponList=function(a){var t=a.data,i="",n="",s=$(".discount_list"),e=$(".history_list");$.each(t,function(a,t){if(0==t.status||1==t.status)i+="<li><i></i><blockquote><h3>¥<span>"+t.couponValue+'</span>元</h3><p>优惠券类型:现金抵用券</p><div class="period">有效期至:'+dateChange(t.endTime,!0)+"</div></blockquote></li>";else if(2==t.status||8==t.status){$(".no_ticket").show();var s=2==t.status?t.usedTime:t.endTime,e=2==t.status?"使用时间：":"有效期至:";n+='<li><div class="expire">'+t.status+"</div><blockquote><h3>¥<span>"+t.couponValue+'</span>元</h3><p>优惠券类型:现金抵用券</p><div class="period">'+e+dateChange(s,!0)+"</div></blockquote></li>"}}),s.append(i),e.append(n)},getOrderConfirm=function(a){var t=a.data,i="",n=t.photoUrl?'<img src="'+imgUrl+item.photoUrl+'" class="prolist_img">':'<img class="prolist_img" src="http://img.autostreetscdn.com/m/build/1.00/images/shop_bm/bm_package.png" alt="">',s=t.availCouponCount?'<span class="orange">'+t.availCouponCount+"张可用</span>":'<span class="gley">无可用</span>',e=t.discountRate?'<span class="orange">'+t.discountRate+"折</span>":"",l=t.discountLaborFees?'<p><span class="old_price">¥'+t.laborFees+"</span>¥"+t.discountLaborFees+"</p>":"<p>¥"+t.laborFees+"</p>",c=t.packagePrice?'<p><span class="old_price">¥'+t.materialPrice+"</span>¥"+t.packagePrice+"</p>":"<p>¥"+t.materialPrice+"</p>";i='<div class="con_main"><div class="confirm">'+n+"<h3>"+t.name+'</h3></div></div><div class="confirm_con clearfix"><h3>预计保养时间：</h3><p><span class="time">'+t.laborHours+'</span>小时（不含洗车）</p></div><div class="confirm_con clearfix"><h4><img class="name" src="http://img.autostreetscdn.com/m/build/1.00/images/shop_bm/name.png" alt="">'+t.customerName+'</h4><p><img class="mobile" src="http://img.autostreetscdn.com/m/build/1.00/images/shop_bm/mobile.png" alt="">'+t.customerCellphone+'</p></div><div class="confirm_info clearfix"><h3>'+t.orgNameAbbr+"</h3><p>门店地址:"+t.address+"</p><p>预约时间:"+t.appointmentTime+'</p></div><div class="confirm_con clearfix"><h3>预约顾问:</h3><p>'+t.consultantName+'</p></div><div class="confirm_con clearfix payment"><a href="bm_payment.html'+location.search+'"><h3>支付方式:</h3><i></i><p>在线支付</p></a></div><div class="confirm_con clearfix ticket"><a href="bm_discount.html'+location.search+'"><h3>抵用券'+s+'</h3><i></i><p>未使用<p></a></div><div class="confirm_con clearfix"><h3>耗材价</h3>'+c+"<h3>工时价"+e+"</h3>"+l+'<h3>抵用券</h3><p></p></div><div class="confirm_pay"><div class="wrap clearfix"><p>：¥'+t.originalPrice+"&nbsp;&nbsp;&nbsp;&nbsp;实付款：<span>¥"+t.lastPrice+'</span></p><a href="#">确认支付</a></div></div>',$("#container").append(i);var o=request();if(o.payment?$(".payment").find("p").text(o.payment):!1,o.discount){$(".ticket>a>p").text("已选择¥"+o.discount+"元");var r=t.lastPrice-o.discount;$(".confirm_pay").find("span").text("¥"+r)}},getOrganList=function(a){var t=a.data,i=$("#shop_list"),n="";t.length?$.each(t,function(a,t){console.log(a,t);for(var s='<i class="unselect_img"></i>',e=t.distance?'<img src="http://img.autostreetscdn.com/m/build/1.00/images/shop_bm/location.png" alt=""><span>'+(t.distance/1e3).toFixed(2)+"km":"",l="",c=t.brandLogos.length,o=0;c>o;o++)l+='<li><img data="'+t.brandLogos[o]+'" src="'+imgUrl+t.brandLogos[o]+'"></li>';l='<ul class="logoList">'+l+"</ul>",n="<li>"+s+'<a href="bm_shop_detail.html?orgSid='+t.orgSid+'"><h3 id="'+t.orgSid+'">'+t.orgNameAbbr+"</h3>"+l+starDom+'<p class="shop">营业时间：'+t.beginTime+"-"+t.endTime+'</p><p class="shop">'+t.address+'</p><div class="location"> '+e+"</span></div></a></li>",i.append(n),t.score&&starShow(t.score,i,a)}):i.append(noResult("很抱歉，没有符合条件的门店"))},getpackageList=function(a){var t=a.data,i=$("#packageList ul"),n="";$.each(t,function(a,t){var i=t.content?t.content:"",s=t.description?t.description:"";n+='<li><blockquote><i class="unselect"></i><h4 id="'+t.id+'">'+t.name+'</h4><div class="price"><span class="old">￥'+t.originalPrice+'</span><span class="new">￥'+t.packagePrice+'</span><ins class="arrow-down"></ins></div><p>适用车型：'+t.applicableModels+'</p></blockquote><section class="content"><h5>套餐内容</h5><p>'+i+'</p></section><section class="time"><h5>注意事项</h5><p>'+s+"</p></section></li>"}),i.append(n)},getMaintenItem=function(a){var t=a.data,i=$("#maintain_item"),n='<li class="unknown" ><i class="unselect"></i><p id="-1">我啥也不知道</p></li>';$.each(t,function(a,t){var i=t.enabled?'<i class="select"></i>':'<i class="unselect"></i>';n+="<li>"+i+'<p id="'+t.id+'">'+t.name+"</p></li>"}),i.empty().append(n);var s=!1;$(".maintain_item li").each(function(){return $(this).children("i").hasClass("select")?(s=!0,!1):void 0}),s||$(".unknown").children("i").removeClass("unselect").addClass("select")},getConsultantDetail=function(a){var t=a.data,i=a.data.organ,n=$(".con_head"),s='<div class="con_main"><div class="person"><img src="'+imgUrl+t.photoUrl+'" class="conlist_img"/><h3>'+t.name+"</h3>"+starDom+'<p class="year">工作年限：'+t.workAge+'年</p><p class="amount">接单数：'+t.orders+'</p></div><a href="tel:'+t.cellphone+'" class="phone"></a></div><div class="addr"><div class="wrap"><img src="'+imgUrl+i.brandLogo+'" class="brandLogo"/><h3>'+i.orgNameAbbr+"</h3><p>"+i.address+'</p></div><div class="con_btn"><a href="tel:'+i.telephone+'" class="telphone">拨打电话</a><a href="bm_shop_detail.html?orgSid='+i.orgSid+'" class="go_shop" id="'+i.orgSid+'">进入店铺</a><a href="http://wx.autostreets.com/html/map.html?lat='+i.latitude+"&lng="+i.longitude+"&name="+i.orgNameAbbr+"&addr="+i.address+'" class="go_map">查看地图</a></div></div>';$(".con_title").text(t.name),n.append(s),starShow(t.score,n);var e=$("#packageList"),l=a.data.organPackage;if(l.length>0){var c="";$.each(l,function(a,t){var i=t.applicableModels?t.applicableModels:"全部车型";c+='<li><a href="bm_package_detail.html?id='+t.id+'"><blockquote><h4>'+t.name+'</h4><div class="price"><span class="old">￥'+t.originalPrice+'</span><span class="new">￥'+t.packagePrice+"</span></div><p>适用车型："+i+"</p></blockquote></a></li> "}),e.append("<h3>保养套餐</h3><ul>"+c+'</ul><div class="checkmore">点击查看更多</div>');for(var o=0;3>o;o++)$("#packageList ul li").eq(o).show()}else $(".checkmore").hide()},getConsultantList=function(a){var t=$("#consultant_list"),i=a.data,n="";i.length||isNotEmptyObj(a.data)?$.each(i,function(a,i){var s=i.isServiced?'<img class="hot" src="http://img.autostreetscdn.com/m/build/1.00/images/booking_maintenance/heart.png" alt="">':"";n='<li><a href="bm_con_detail.html?consultSid='+i.id+'">'+s+'<img src="'+imgUrl+i.photoUrl+'" class="conlist_img"/><h3>'+i.name+"</h3>"+starDom+'<p class="title">'+i.jobTitle+'</p><p class="year">工作年限：'+i.workAge+'年</p><p class="shop">所属门店：'+i.orgNameAbbr+"</p></a></li>",t.append(n),i.score&&starShow(i.score,t,a)}):(n='<li class="nodata">抱歉，没有符合条件的顾问</li>',t.append(n))},dateChange=function(a){var t=new Date(a),i=t.getFullYear(),n=t.getMonth()+1,s=t.getDate(),e=t.getHours(),l=t.getMinutes(),c=t.getSeconds(),o=i+"-";return 10>n&&(o+="0"),o+=n+"-",10>s&&(o+="0"),o+=s+" ",10>e&&(o+="0"),o+=e+":",10>l&&(o+="0"),o+=l+":",10>c&&(o+="0"),o+=c};