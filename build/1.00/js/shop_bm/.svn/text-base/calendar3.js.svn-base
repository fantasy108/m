/*
 * Build by xuelei.kong@autostreets.com
 * Date: 2016-04-07 10:30:42
 * Version: 1.00
 */
function Calendar(t,e){this.Container=$(t),this.Days=[],this.setOptions(e),this.tipBox=$(".active_tip"),this.Year=this.options.Year||(new Date).getFullYear(),this.Month=this.options.Month||(new Date).getMonth()+1,this.SelectDay=this.options.SelectDay?new Date(this.options.SelectDay):null,this.onSelectDay=this.options.onSelectDay,this.onToday=this.options.onToday,this.onFinish=this.options.onFinish,this.MonthArr=["01","02","03","04","05","06","07","08","09","10","11","12"],this.timer=null,this.minDateId=(new Date).getFullYear()+"_"+((new Date).getMonth()+1)+"_"+(new Date).getDate(),this.init()}Calendar.prototype={init:function(){this.draw()},setOptions:function(t){this.options={Year:0,Month:0,SelectDay:null,onSelectDay:function(){},onToday:function(){},onFinish:function(){}},$.extend(this.options,t||{})},preMonth:function(){this.PreDraw(new Date(this.Year,this.Month-2,1))},nextMonth:function(){this.PreDraw(new Date(this.Year,this.Month,1))},PreDraw:function(t){this.Year=t.getFullYear(),this.Month=t.getMonth()+1,this.draw()},draw:function(){var t=[];this.pM=new Date(this.Year,this.Month-1,0).getMonth()+1,this.nM=new Date(this.Year,this.Month+1,0).getMonth()+1,this.firstDay=new Date(this.Year,this.Month-1,7).getDay(),this.prevMonthDays=new Date(this.Year,this.Month-1,0).getDate();for(var e=this.prevMonthDays-this.firstDay+1;e<=this.prevMonthDays;e++)t.push({prevMonth:{day:e,month:this.pM}});for(var e=1,n=new Date(this.Year,this.Month,0).getDate();n>=e;e++)t.push({currMonth:{day:e,month:this.Month}});for(var e=1;e<=42-n-this.firstDay;e++)t.push({nextMonth:{day:e,month:this.nM}});$.each(t,function(t,e){}),this.Days=[];for(var a=document.createDocumentFragment();t.length;){var i=document.createElement("div");i.className="row";for(var e=1;7>=e;e++){var h=document.createElement("p"),s=document.createElement("span");if(s.innerHTML=" ",h.appendChild(s),t.length){var o=t.shift();for(var r in o)"currMonth"==r&&(h.className+="day currMonth",s.innerHTML=o[r].day,h.setAttribute("id","day_"+this.Year+"_"+o[r].month+"_"+o[r].day));this.Days[o[r].day]=h;var c=new Date(this.Year,o[r].month-1,o[r].day);$(h).hasClass("currMonth")&&this.checkDay(c)&&(h.className+=" nextDay",c.getTime()<=this.theNextDays(14)&&(h.className+=" enable")),this.IsSame(c,new Date)&&"day currMonth"==h.className&&this.onToday(h),this.SelectDay&&this.IsSame(c,this.SelectDay)&&this.onSelectDay(h)}i.appendChild(h)}a.appendChild(i)}this.Container.empty(),this.Container.append(a),this.onFinish()},checkDay:function(t){return(new Date).getTime()>t.getTime()?!1:!0},theNextDays:function(t){var e=new Date,n=e.setDate(e.getDate()+t-1);return this.maxDateId=new Date(n).getFullYear()+"_"+(new Date(n).getMonth()+1)+"_"+new Date(n).getDate(),new Date(n).getTime()},IsSame:function(t,e){return t.getFullYear()==e.getFullYear()&&t.getMonth()==e.getMonth()&&t.getDate()==e.getDate()}};var calendar=new Calendar(".calendar_date",{onToday:function(t){$(t).addClass("today").find("span").html("今天")},onFinish:function(){$(".year").html(this.Year+"年"),$(".month").html(this.MonthArr[this.Month-1]+"月")}});$(".calendar_hd .prevBtn").click(function(){$("#day_"+calendar.minDateId).length||calendar.preMonth()}),$(".calendar_hd .nextBtn").click(function(){$("#day_"+calendar.maxDateId).length||calendar.nextMonth()});