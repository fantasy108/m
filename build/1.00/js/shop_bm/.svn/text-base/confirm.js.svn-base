/*
 * Build by xuelei.kong@autostreets.com
 * Date: 2016-04-07 10:30:42
 * Version: 1.00
 */
$(function(){var e=request(),t=!1;if(localStorage.maintainitem){var a=localStorage.maintainitem,i=JSON.parse(a),n="";$.each(i,function(e,t){n+='<li><i class="select"></i><p id="'+t.id+'">'+t.name+"</p>"}),$("#maintain_item").append(n);var o=$("#maintain_item li").eq(0).children("p");-1==o.attr("id")&&o.text("未选择，需要到店确认")}else $(".maintain_tit").eq(0).hide();if(e.packageId)packageDetail(e.packageId);else if(localStorage.packageitem){var c=localStorage.packageitem,s=JSON.parse(c);if(s&&s.length>0){var r="";$.each(s,function(e,t){var a=t.old_price.replace("￥",""),i=t.new_price.replace("￥","");r+='<li><p id="'+t.id+'">'+t.name+'</p><i>¥<span data-oldPrice="'+a+'">'+i+"</span></i></li>"}),$(".discount").append(r),priceAmount()}else s.length<=0&&($(".dc_package").hide(),$(".payment").hide(),$(".confirm_pay .wrap p").hide(),$(".confirm_pay .wrap a").text("预约确认"));$(".booking_time a").attr("href","bm_time.html?orgSid="+e.orgSid)}var l=$(".shop_info .wrap");if(sessionStorage.shopInfo){var d,m=sessionStorage.shopInfo;d=JSON.parse(m),l.children("h3").text(d.name),l.children("img").attr("src",imgUrl+d.src),l.children("p").text(d.addr),l.children("p").attr("id",d.orgSid)}else l.children("h3").text(e.orgNameAbbr),l.children("p").attr("id",e.orgSid),l.children("img").attr("src",imgUrl+e.brandLogo),l.children("p").text(e.address);if(e.payment?$(".payment").find("p").text(e.payment):!1,e.date||e.time){if(e.discount&&""!=e.discount&&"null"!=e.discount){var n="";n='<span class="off">'+e.discount+"</span>",$(".detail").prepend(n)}$(".booking_time .txt").text(e.date+" "+e.time)}if("false"==e.conSwitch&&e.packageId?(e.date&&e.time&&autoSeleCon(e.orgSid,e.date+" "+e.time),t=!1,$(".has_con").removeClass("open_icon").addClass("close_icon")):e.consultSid?(consultantDetail2(e.consultSid),t=!0,$(".has_con").removeClass("close_icon").addClass("open_icon")):"true"==e.conSwitch?($(".has_con").removeClass("close_icon").addClass("open_icon"),$(".con_name").text(e.conName),$(".con_name").attr("id",e.consultSid),t=!0):("false"==e.conSwitch||"undefined"==e.conSwitch)&&(e.date&&e.time&&autoSeleCon(e.orgSid,e.date+" "+e.time),t=!1,$(".has_con").removeClass("open_icon").addClass("close_icon")),sessionStorage.my_cust_vehicle_info){var h=sessionStorage.my_cust_vehicle_info,p=JSON.parse(h),n="<li><p>"+p.selledName+"</p></li>";$(".maintain_car").empty().append(n)}var S,_,f,g;sessionStorage.member_info&&(S=sessionStorage.member_info,_=JSON.parse(S),$("#name").val(null==_.name?"":_.name),$("#mobile").val(null==_.cellphone?"":_.cellphone)),sessionStorage.order_info&&(f=sessionStorage.order_info,g=JSON.parse(f),(""!=g.name||null!=g.name||void 0!=g.name)&&$("#name").val(g.name),(""!=g.cellphone||null!=g.cellphone||void 0!=g.cellphone)&&$("#mobile").val(g.cellphone),(""!=g.payment||null!=g.payment||void 0!=g.payment)&&$(".payment select").val(g.payment)),$(".payment a").attr("href","bm_payment.html"+location.search+"&conSwitch="+t),$(".maintain_tit").on("click",function(){var e=$(this).children("ins");e.hasClass("arrow-down")?(e.removeClass("arrow-down").addClass("arrow-up"),$(this).next("ul").hide()):(e.removeClass("arrow-up").addClass("arrow-down"),$(this).next("ul").show())}),$(".has_con").on("click",function(){if($(this).hasClass("open_icon"))$(this).removeClass("open_icon").addClass("close_icon"),t=!1,$(".off").hide(),$(".detail .txt").text(""),$(".con_name").text("");else if($(this).hasClass("close_icon")){var a={name:$("#name").val(),cellphone:$("#mobile").val(),payment:$(".payment select").val()};sessionStorage.order_info=JSON.stringify(a),e.packageId?(t=!0,window.location.href="bm_sele_consultant.html"+location.search+"&conSwitch="+t+"&orgSid="+$(".shop_info>.wrap>p").attr("id")):(t=!0,window.location.href="bm_sele_consultant.html"+location.search+"&conSwitch="+t)}}),$(".correct").click(function(){popdown()}),$(".booking_time").on("click","a",function(){var a={name:$("#name").val(),cellphone:$("#mobile").val(),payment:$(".payment select").val()};sessionStorage.order_info=JSON.stringify(a);var i=$(this).attr("href");if(e.packageId&&0==t)e.date||e.time?$(this).attr("href",i+"&packageId="+e.packageId+"&conSwitch="+t+"&date="+e.date+"&time="+e.time):$(this).attr("href",i+"&packageId="+e.packageId+"&conSwitch="+t);else if(e.packageId){var n=$(".con_name").text();""==n?e.date||e.time?$(this).attr("href","bm_time.html"+location.search+"&conSwitch="+t):$(this).attr("href",i+"&packageId="+e.packageId):e.date||e.time?$(this).attr("href","bm_time.html"+location.search+"&conSwitch="+t+"&conName="+n+"&consultSid="+$(".con_name").attr("id")):$(this).attr("href",i+"&packageId="+e.packageId+"&conName="+n+"&consultSid="+$(".con_name").attr("id"))}else e.consultSid?0==t?e.date||e.time?$(this).attr("href","bm_time.html?orgSid="+e.orgSid+"&date="+e.date+"&time="+e.time+"&conSwitch="+t):$(this).attr("href","bm_time.html?orgSid="+e.orgSid+"&conSwitch="+t):1==t&&(e.date||e.time?$(this).attr("href","bm_time.html?orgSid="+e.orgSid+"&consultSid="+e.consultSid+"&date="+e.date+"&time="+e.time+"&conSwitch="+t):$(this).attr("href","bm_time.html?orgSid="+e.orgSid+"&consultSid="+e.consultSid+"&conSwitch="+t)):e.date||e.time?$(this).attr("href",i+"&conSwitch="+t+"&date="+e.date+"&time="+e.time):$(this).attr("href",i+"&conSwitch="+t)})});