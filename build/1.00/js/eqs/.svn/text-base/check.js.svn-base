/*
 * Build by xuelei.kong@autostreets.com
 * Date: 2016-04-07 10:30:42
 * Version: 1.00
 */
function clear_data(){$(".damagePhoto").attr("src","http://img.autostreetscdn.com/m/build/1.00/images/eqs/driver_card.png"),$(".damagePhoto").attr("data-photourl",""),$(".driver_card input").prop("checked",!1),$(".detail_list li").each(function(){$(this).removeClass("cur")})}function onMouseMove(t){t.preventDefault(),flag&&(currentPos=pos(t))}function onMouseDown(t){t.preventDefault(),startPos=currentPos=pos(t),console.log(startPos.x,startPos.y),flag=!0}function onMouseUp(t){t.preventDefault();var a=currentPos.x-startPos.x,e=currentPos.y-startPos.y;ctx.strokeStyle="#ff0000",ctx.linewidth=10,ctx.strokeRect(startPos.x,startPos.y,a,e),$("#clear").css("display","inline-block"),flag=!1,$(".process li:eq(2) span").addClass("cur"),$(".process li:eq(1)").removeClass("bold"),$(".process li:eq(2)").addClass("bold")}function pos(t){var a,e;return isTouch(t)?(a=t.touches[0].pageX-os.x,e=t.touches[0].pageY-os.y):(a=t.layerX-os.x,e=t.layerY-os.y),{x:a,y:e}}function isTouch(t){var a=t.type;return a.indexOf("touch")>=0?!0:!1}function init(){$("#myCanvas,#clear,.canvas_save").hide(),$(".canvas_pop").removeClass("layer_show2"),$(".upload").css("display","inline-block"),$(".upload,#fileBtn,#file").css("width","1.63125rem"),reset()}function reset(){$(".process li:eq(2) span").removeClass("cur"),$(".process li:eq(1)").removeClass("bold"),$(".process li:eq(2)").removeClass("bold"),$(".process_notice").text("你可以移动、缩放、旋转图片，以保证所要拍摄的内容在虚框内显示"),$(".gesture img").attr("src","http://img.autostreetscdn.com/m/build/1.00/images/eqs/gesture2.png")}function isCzhj(){var t=!1,a=0;$(".detail_list li").each(function(){"拆装痕迹"==$(this).children("p").text()?a=$(this).hasClass("cur")?1:0:"拆装痕迹"!=$(this).children("p").text()&&$(this).hasClass("cur")&&(t=!0)});var e=$(".driver_card input,.driver_card label");$(".detail_list").is(":hidden")?e.hide():t?e.show():0==t&&0==a?e.show():0==t&&1==a&&e.hide()}$(function(){outwardCheck();var t;$(".harm_list,#checked_point").on("click","li",function(){$(".detail_list").height(list_height()),$("body").css("position","fixed"),$(this).parent().hasClass("harm_list")?"是"==$(this).find("span").text()?($("#input_icon").addClass("cur"),clear_data()):$("#input_icon").removeClass("cur"):$(this).hasClass("cur")?$("#input_icon").removeClass("cur"):($("#input_icon").addClass("cur"),clear_data()),$(".detail_head .save").attr("id",$(this).attr("id")),$(this).attr("data-photourl")?$(".damagePhoto").attr("src",$(this).attr("data-photourl")):$(".damagePhoto").attr("src","http://img.autostreetscdn.com/m/build/1.00/images/eqs/driver_card.png"),"true"==$(this).attr("data-showdamagestatus")?$(".detail_title,.detail_list").show():$(".detail_title,.detail_list").hide(),"true"==$(this).attr("data-showdamagelevel")?$(".driver_card input,.driver_card label").show():$(".driver_card input,.driver_card label").hide();var t=$(this).attr("data-damagelevelselected");switch(t){case"轻微":$("#small").prop("checked",!0);break;case"一般":$("#normal").prop("checked",!0);break;case"严重":$("#big").prop("checked",!0)}var a=$(this).attr("data-damagestatusoption");switch(a){case"damage_status_appearance_1":for(var e=damageStatus_1.length,s=$(".detail_list"),i="",r=0;e>r;r++)i+="<li><p>"+damageStatus_1[r]+"</p><i></i></li>";s.empty().append(i);break;case"damage_status_appearance_2":for(var e=damageStatus_2.length,s=$(".detail_list"),i="",r=0;e>r;r++)i+="<li><p>"+damageStatus_2[r]+"</p><i></i></li>";s.empty().append(i);break;case"damage_status_appearance_3":for(var e=damageStatus_3.length,s=$(".detail_list"),i="",r=0;e>r;r++)i+="<li><p>"+damageStatus_3[r]+"</p><i></i></li>";s.empty().append(i)}var o=$(this).attr("data-damagestatusselected");if(o)for(var c=o.split(","),e=c.length,n=0;e>n;n++)$(".detail_list li").each(function(){$(this).children("p").text()==c[n]&&$(this).addClass("cur")});$(".detail_list li").each(function(){"拆装痕迹"==$(this).children("p").text()&&$(this).hasClass("cur")&&$(".damagePhoto").siblings().hide()}),$(".harm_detail").addClass("layer_show"),isCzhj()}),$(".detail_head .save").on("click",function(){$("body").css("position","static");var t,a,e=new Array,s=$(".damagePhoto").attr("src"),i=$(".damagePhoto").attr("data-photourl");"none"==$(".driver_card input").css("display")?a=!0:$(".driver_card input").each(function(){return 1==$(this).prop("checked")?(t=$(this).next().text(),a=!0,!1):void(a=!1)}),"none"==$(".detail_list").css("display")?e=" ":$(".detail_list li").each(function(){$(this).hasClass("cur")&&e.push($(this).children("p").text())});var r;if($("#input_icon").hasClass("cur"))r=!0;else{if(r=!1,"http://img.autostreetscdn.com/m/build/1.00/images/eqs/driver_card.png"==s)return popup("请拍摄损伤照片"),!1;if(""==e)return popup("请选择损伤状况"),!1;if(!a)return popup("请选择损伤等级"),!1}var o=$(this).attr("id");$(".harm_list li").each(function(){$(this).attr("id")==o&&($(this).attr("data-state",1),$(this).attr("data-photourl",s||i),t=t?t:"",e=e?e:"",$(this).attr("data-damagelevelselected",t),$(this).attr("data-damagestatusselected",e),t&&e?$(this).find(".txt").text(t+"-"+e):t?!t&&e&&$(this).find(".txt").text(""):$(this).find(".txt").text(e),$("#input_icon").hasClass("cur")?$(this).find("span").text("是").removeClass("non"):$(this).find("span").text("否").addClass("non"))}),$("#checked_point li").each(function(){$(this).attr("id")==o&&(r?($(this).attr("data-state",0),$(this).attr("data-photourl",s||i),t=a?t:"",$(this).attr("data-damagelevelselected",t),$(this).attr("data-damagestatusselected",e),$(this).find(".txt").text(t+"-"+e),$(this).removeClass("cur")):($(this).attr("data-state",1),$(this).attr("data-photourl",s||i),t=a?t:"",$(this).attr("data-damagelevelselected",t),$(this).attr("data-damagestatusselected",e),$(this).find(".txt").text(t+"-"+e),$(this).addClass("cur")))}),$(".harm_detail").removeClass("layer_show");var c=i?i:"";console.log(e),e=" "==e?"":e.join(","),_form(parseInt(o),r,c,e,t),$(".damagePhoto").attr("data-photourl",""),$(".damagePhoto").attr("src","")}),$(".detail_list").on("click","li",function(){$(this).hasClass("cur")?$(this).removeClass("cur"):$(this).addClass("cur"),isCzhj(),$("#input_icon").removeClass("cur")}),$(".driver_card input").on("click",function(){$("#input_icon").removeClass("cur")}),$(".clear_data").on("click",function(){$(this).children("#input_icon").hasClass("cur")?$("#input_icon").removeClass("cur"):($("#input_icon").addClass("cur"),t=$(".detail_head .save").attr("id"),popup2("该部位是否完好（该操作会清空数据）"))}),$(".close").on("click",function(){$(".harm_detail").removeClass("layer_show"),$("body").css("position","static")}),$(".hidden").on("click",function(){$(".harm_list").css("margin","0.45rem 0 0 0"),$(".car_content").css("padding","0.1125rem"),$(".spread").show(),$(".harm").hide(),$(this).hide()}),$(".spread").on("click",function(){$(".harm_list").css("margin",0),$(".car_content").css("padding","3.375rem 0.1125rem 0.1125rem 0.1125rem"),$(".hidden").show(),$(".harm").show(),$(this).hide()}),$(".cancel").on("click",function(){$(".error_layer2").hide(),$("#input_icon").removeClass("cur"),$(".tipbg").hide()}),$(".error_layer .correct").on("click",function(){$(".error_layer").hide(),$(".tipbg").hide()}),$(".error_layer2 .correct").on("click",function(){clear_data(),$(".error_layer2").hide(),$("#tipbg").hide(),$(".harm_list li").each(function(){return $(this).attr("id")==t?($(this).attr("data-state",1),$(this).removeAttr("data-damagelevelselected"),$(this).removeAttr("data-damagestatusselected"),$(this).removeAttr("data-photourl"),$(this).find("span").text("是").removeClass("non"),$(this).find(".txt").text(""),!1):void 0}),$("#checked_point li").each(function(){$(this).attr("id")==t&&$(this).removeClass("cur")})}),$(".damagePhoto").on("click",function(){$("#file").click()}),$("#file").on("click",function(){$("#myCanvas,.canvas_save").hide(),$("#clipArea").show(),$("#clipBtn").css("display","inline-block"),$("#clear").css("display","none"),reset()}),$(".canvas_save").on("click",function(){init(),dataUrl=canvas.toDataURL("image/jpeg"),$(".damagePhoto").attr("src","").attr("src",dataUrl).attr("data-photourl",dataUrl),$("#input_icon").removeClass("cur"),$(".photo-clip-rotateLayer img").attr("src",""),document.removeEventListener("touchmove",bodyScroll,!1)}),$(".canvas_close").on("click",function(){init(),document.removeEventListener("touchmove",bodyScroll,!1)})});var _winWidth=$(window).width();$(".damagePhoto").css("width",_winWidth);var _width=$(".damagePhoto").width(),_height=$(".damagePhoto").height(),os={x:0,y:0},dataUrl,canvas=document.getElementById("myCanvas"),ctx=canvas.getContext("2d");canvas.addEventListener("mousemove",onMouseMove,!1),canvas.addEventListener("mousedown",onMouseDown,!1),canvas.addEventListener("mouseup",onMouseUp,!1),canvas.addEventListener("touchstart",onMouseDown,!1),canvas.addEventListener("touchmove",onMouseMove,!1),canvas.addEventListener("touchend",onMouseUp,!1),$("#clipArea").photoClip({width:_width-20,height:_height-20,file:"#file",view:"#view",ok:"#clipBtn",loadStart:function(){console.log("照片读取中")},loadComplete:function(){console.log("照片读取完成"),$(".canvas_pop").addClass("layer_show2"),$("#clipBtn").show(),$(".process li:eq(0)").addClass("bold"),$(".process li:eq(1) span").removeClass("cur")},clipFinish:function(t){$(".process li:eq(1) span").addClass("cur"),$(".process li:eq(0)").removeClass("bold"),$(".process li:eq(1)").addClass("bold"),$(".process_notice").text("框出损伤处"),$(".gesture img").attr("src","http://img.autostreetscdn.com/m/build/1.00/images/eqs/gesture2b.png"),$("#clipArea,#clipBtn").hide(),$("#clear,.canvas_save").css("display","inline-block"),$(".upload,#fileBtn,#file").css("width","1.2rem"),$("#myCanvas").prop({width:_width,height:_height}).show(),os.x=$("#myCanvas").offset().left,os.y=$("#myCanvas").offset().top;var a=new Image;a.src=t,a.onload=function(){ctx.drawImage(a,0,0,_width,_height)},$("#clear").on("click",function(){$(".process li:eq(2) span").removeClass("cur"),$(".process li:eq(1)").addClass("bold"),$(".process li:eq(2)").removeClass("bold"),ctx.clearRect(0,0,500,300),ctx.drawImage(a,0,0,_width,_height)})}});var flag=!1,startPos,currentPos,bodyScroll=function(t){t.preventDefault()};