/*
 * Build by xuelei.kong@autostreets.com
 * Date: 2016-04-07 10:30:42
 * Version: 1.00
 */
$(function(){function e(){var e=this,t=arguments[1],a={type:"GET",url:e,dataType:"jsonp",jsonp:"jsoncallback",data:arguments[0],beforeSend:function(){V.show(),M=!1},success:function(e){V.hide(),t(e)}};arguments[0].hasOwnProperty("type")&&(a.type="POST"),$.ajax(a)}function i(e){var t=$('<li  class="no_result"><div><p>很抱歉，没有符合条件的车辆</p></div></li>');$(e).empty().append(t)}function s(t){var a={appraiserId:sessionStorage.appraiserId,current:1},s=$.extend(a,t),n=s.searchAuditedStatusByEQS||"s";e.call(X.userEqsListPort,s,function(e){function t(e,t){var a=t&&t.substring(0,1),i="A"==a&&"high"||"B"==a&&"top"||"C"==a&&"middle"||"D"==a&&"low";return e?'<div class="score '+i+'"><span>'+e+t+"</span></div>":""}e.extras.count?($.each(e.data,function(a,i){if(99==n||"未上传"==i.auditedStatusText)var s="add_car";else var s="sec_hand_check";$("#detection_list_"+n).data("length",e.extras.count),i.auditedStatusText&&$("#detection_list_"+n).append('<li><a href="'+s+".html?appraiserId="+sessionStorage.appraiserId+"&status="+n+'" data-statustxt="'+i.auditedStatusText+'" data-vehicleid="'+i.vehicleId+'" data-code="'+i.code+'" data-status="'+n+'" class="detection_item" href=""> <div class="img_wrap">'+l(i.firstPhoto)+t(i.score,i.grade)+'</div><div class="car_info"><h2>'+i.vehicleName+"</h2><h3>"+(i.licenseCode||"")+"</h3><p>车辆编号：<span>"+i.code+'</span></p><p><span class="date">'+i.uploadDtm+'</span><!--<span class="time">13:22:57</span>--></p><span class="status status'+n+'">'+i.auditedStatusText+"</span></div></a></li>")}),$("#detection_list_"+n).delegate(".detection_item","click",function(){sessionStorage.setItem("vehicleId",$(this).data("vehicleid")),sessionStorage.setItem("status",$(this).data("status"))}),99==n&&$("#detection_list_99").find("li").length>=e.extras.num&&$("#addCar").addClass("disable").html("未上传车辆最多为"+e.extras.num+"条").prop("href","javascript:void(0)"),M=!0):i("#detection_list_"+n)})}function n(e){return a=1==e&&++R||2==e&&++D||0==e&&++U||99==e&&++F||"s"==e&&++Q}function o(){K.show(),z.hide().empty(),J.val("0"),$("#search").hide(),$("#top_filter_wrap").show(),$("#wrapper").removeClass("searching"),W.removeClass("focus"),$(".sub_opt").show(),W.val(""),T(),O=$(".top_filter .curr").data("code"),$("#detection_list_"+O).empty(),s({searchAuditedStatusByEQS:O})}function l(e){return e?'<img src="'+B+e+'" alt="">':""}function r(e){function t(){var t=e||{title:"默认标题",closeBtn:!1,content:"描述文字。。。",btnYes:{text:"确定",url:"http://www.yhd.com"},btnNo:{text:"取消",url:"http://www.yhd.com"}};if(t.closeBtn)var i='<b class="close"></b>';else var i="";if(t.hasOwnProperty("title"))var s='<div class="title">'+t.title+"</div>";else var s="";if(t.hasOwnProperty("btnYes"))var n='<a href="'+t.btnYes.url+'" class="btn_public btnYes">'+t.btnYes.text+"</a>";else var n="";if(t.hasOwnProperty("btnNo"))var o='<a href="'+t.btnNo.url+'" class="btn_public btnNo">'+t.btnNo.text+"</a>";else var o="";var l='<div class="popup_wrap">'+s+i+'<div class="text">'+t.content+'</div><div class="btn_box">'+o+n+"</div></div>",r=document.createElement("div");r.id="popupTipsLocation",r.innerHTML=l,document.body.appendChild(r),r.querySelector(".close")&&close.addEventListener("click",function(){a()},!1);r.querySelector(".popup_wrap"),r.querySelector(".popup_wrap");r.querySelector(".btnNo")&&r.querySelector(".btnNo").addEventListener("click",function(){a()},!1),r.querySelector(".btnYes")&&r.querySelector(".btnYes").addEventListener("click",function(){a(),t.btnYes.callback&&t.btnYes.callback()},!1)}function a(){var e=document.querySelector("#popupTipsLocation");e.parentNode.removeChild(e)}t()}function c(){r({content:"您所修改的内容尚未保存，是否确定返回",btnNo:{text:"取消",url:"javascript:void(0)"},btnYes:{text:"确定",url:"javascript:history.go(-1)"}})}function d(e,t){var a={tap:!0,scrollX:!1,scrollY:!0,scrollbars:!0,mouseWheel:!0,interactiveScrollbars:!1,shrinkScrollbars:"scale",fadeScrollbars:!0},i=$.extend({},a,t||{});return $(e).find(".iScrollVerticalScrollbar").remove(),"undefined"!=typeof IScroll?new IScroll(e,i):void 0}function p(e,t,a){$(e).click(function(){var e=$(this).index();$(this).addClass("curr").siblings().removeClass("curr"),$(t).eq(e).show().siblings(t).hide(),a&&"function"==typeof a&&a(e)})}function u(){$(".layer").removeClass("show_layer"),T()}function h(e){var t=e.type;return t.indexOf("touch")>=0?!0:!1}function v(){this.each(function(){function e(e){var t=e.clientX||e.touches[0].clientX,a=e.clientX||e.touches[0].clientY,s=t-startX+i;$(".slider ul").css({"-webkit-transition":"all 0s","-webkit-transform":"translate("+s+"px,0)"}),finishX=t,finishY=a}function t(){r.addEventListener(o,e)}var a=$(this)[0];a.style.Transform="translate(0px,0px)",a.style.webkitTransform="translate(0px,0px)";var i=0,s=-($(this).width()-j+$(".hd").width());if(se)var n="touchstart",o="touchmove",l="touchend",r=a;else var n="mousedown",o="mousemove",l="mouseup",r=document;a.addEventListener(n,function(){startX=event.clientX||event.touches[0].clientX,startY=event.clientX||event.touches[0].clientY,initX=startX,initY=startY,i=Number(this.style["-webkit-transform"].match(/\-?[0-9]+/g)[0]),this.style.Transition="all 0s",this.style.webkitTransition="all 0s",startTime=Date.now(),t(event)}),r.addEventListener(l,function(t){i=Number(a.style["-webkit-transform"].match(/\-?[0-9]+/g)[0]),i>0&&$(".slider ul").css({"-webkit-transition":"all .3s","-webkit-transform":"translate(0,0)"}),s>i&&$(".slider ul").css({"-webkit-transition":"all .3s","-webkit-transform":"translate("+s+"px,0)"}),initX=0,finishX=0,se||(document.removeEventListener("mousemove",e,!1),document.removeEventListener("mouseup",e,!1))})})}function f(t){var a={brand:"品牌",brandSeries:"车系",manufacturer:"厂家",suggestionPrice:"新车指导价",oilType:"燃料类型",maxPower:"最大功率(KW)",producedYear:"生产年份",produceingType:"国产合资进口",selledName:"销售名称",sweptVolume:"排量(升)",sweptVolumeStandard:"排放标准",bodyType:"车身款式",transmissionType:"变速器类型",vehicleModel:"车型",category:"车辆类型"};e.call(X.vinPort,{vinCode:t},function(e){if(e.success&&e.data){var t=e.data,i=$.extend({},a,t.item),s=[],n=t.list;$(".param_field").empty();for(var o in i)s.push(o),$(".param_field").append("<li><span>"+i[o]+"</span></li>");$("#car_list ul").empty(),$("#param_list ul").empty(),$.each(n,function(e,t){$("#car_list ul").append('<li><div class="item"><p class="car">'+t.brand+t.brandSeries+'</p><a class="select_car" href="javascript:void(0)" data-brand="'+t.brand+'" data-manufacturer="'+t.manufacturer+'" data-brandseries="'+t.brandSeries+'" data-vehiclemodel="'+t.vehicleModel+'" data-car="'+t.brand+" "+t.manufacturer+" "+t.brandSeries+'" data-sellname="'+t.selledName+'" data-sweptvolume="'+t.sweptVolume+'" data-maxpower="'+t.maxPower+'" data-airtype="'+t.airType+'" data-producedyear="'+t.producedYear+'" data-transmissiontype="'+t.transmissionType+'" data-oiltype="'+t.oilType.substring(0,2)+'" data-transmissiontype="'+t.transmissionType+'"data-featureitems="'+(t.featureItems||"")+'" data-levelid="'+t.levelId+'">选择</a></div></li>');var a="<li><ol>";$.each(s,function(e,i){a+="<li><span>"+(t[i]||"无")+"</span></li>"}),a+="</ol></li>",$("#param_list ul").append(a)}),$("#car_list ul").width($("#car_list ul li").length*$("#car_list ul li").outerWidth(!0)+2),$("#param_list ul").width($("#param_list ul>li").length*$("#param_list ul>li").outerWidth(!0)+2),$(".slider").width()<$(".slider ul").width()&&v.call($(".slider ul")),n.length>1?($("#vin_layer").addClass("show_layer"),x()):$(".select_car").click(),d("#car_param",{bounce:!1})}else alert(e.msg)})}function m(){e.call(X.baseInfoParamPort,{},function(e){{var t=e.data;t.vehicleFeature}$.each(t.bodyColor,function(e,t){$("#bodyColor").append('<option value="'+t+'">'+t+"</option>")}),$.each(t.interiorColor,function(e,t){$("#interiorColor").append('<option value="'+t+'">'+t+"</option>")}),$.each(t.oilType,function(e,t){$("#oilType").append('<option value="'+t+'">'+t+"</option>")}),$.each(t.sweptVolumeType,function(e,t){$("#sweptVolumeType").append('<label for="v_'+t+'"><input id="v_'+t+'" type="radio" name="sweptVolumeType" value="'+t+'"><span>'+t+"</span></label>")}),$.each(t.transmissionType,function(e,t){$("#transmissionType").append('<option value="'+t+'">'+t+"</option>")}),sessionStorage.vehicleId||($("#yes")[0].checked=!0),_()})}function g(t){e.call(X.getLicensePort,{},function(e){te=e.data,$.each(te,function(e,t){$("#registerProvince").append('<option data-id="'+e+'" class="reg_pro">'+t.province+"</option>")}),sessionStorage.vehicleId&&y(t,te)})}function _(){e.call(X.getLocationPort,{},function(a){ae=a.data,$.each(a.data,function(e,t){$("#currentProvince").append('<option class="province_opt" data-id="'+e+'" value="'+t.province+'">'+t.province+"</option>")}),g(ae),$("#licenseCode").blur(function(){var t=$.trim($(this).val());""!=t&&e.call(X.getByLicensePort,{license:t},function(e){if(e.success){var t=e.data.province,a=e.data.city;$("#registerProvince").val(t);var i=$("#registerProvince").find("option:selected").data("id");$("#registerCity").find(".city_opt").remove(),$.each(te[i].cityList,function(e,t){$("#registerCity").prop("disabled",!1).append('<option class="city_opt" data-lic="'+t.license+'" value="'+t.city+'">'+t.city+"</option>")}),$("#registerCity").val(a)}})}),$("#registerCity").change(function(){var e=$(this).find("option:selected").data("lic");$("#licenseCode").val(e)}),$("#power").blur(function(){var e=$(this);""!=$(this).val()&&$(this).val()<.1&&(alert("最大功率不得小于0.1"),$("#power").val(""),e.focus())}),$("#sweptVolume").blur(function(){t=$(this),""!=$(this).val()&&$(this).val()<.1&&(alert("排气量不得小于0.1"),$("#sweptVolume").val(""),t.focus())}),$("#power").blur(function(){var e=$(this),t=$.trim(e.val());t&&(isNaN(t)?(alert("请输入正确的数值"),e.focus(),e.val("")):Number(t)>999&&(e.val(""),alert("输入的数字不能大于999.00"),e.focus()))}),$("#displayMileage").blur(function(){$(this).val()>9999999&&(alert("最大里程为9999999公里"),$(this).val(""))}),$("#sweptVolume").blur(function(){var e=$(this);val=$.trim(e.val()),val&&(isNaN(val)?(alert("请输入正确的数值"),e.focus(),e.val("")):Number(val)>20?(e.val(""),alert("输入的数字不能大于20.00"),e.focus()):(-1==val.indexOf(".")||val.substring(val.indexOf(".")).length>3||1==val.substring(val.indexOf(".")).length)&&(e.val(""),alert("输入格式错误！范例：n.n或n.nn"),e.focus()))}),$(".province").change(function(){var e=$(this).prop("name"),t=$(this).val(),a="registerProvince"==e?te:ae,i=$(this).find("option:selected").data("id"),s=$(this).parents("li").next("li").find(".city");return s.prop("disabled",!1).find(".city_opt").remove(),""==t?void s.prop("disabled",!0).find(".city_opt").remove():void $.each(a[i].cityList,function(a,i){if("registerProvince"==e){if(s.append('<option data-lic="'+i.license+'" class="city_opt" value="'+i.city+'">'+i.city+"</option>"),-1!=t.indexOf("市"))return!1}else s.append('<option class="city_opt" value="'+i+'">'+i+"</option>")})})})}function y(t,a){e.call(X.getBaseInfoPort,{vehicleId:sessionStorage.vehicleId},function(e){{var i=e.data;i.featureItemList,i.personalFeatureItemList}i.vehicleLicenseUrl&&$("#get_photo").append('<img src="'+B+i.vehicleLicenseUrl+'" class="finalImg"/>'),$("#brand_val").html(null==i.brand?"":i.brand+" "+i.manufacturer+" "+i.brandSeries),$('input[name="brand"]').val(i.brand),$('input[name="manufacturer"]').val(i.manufacturer),$('input[name="brandSeries"]').val(i.brandSeries),$('input[name="vehicleModel"]').val(""),$('input[name="levelId"]').val(i.levelId),i.sweptVolumeType&&$("#v_"+i.sweptVolumeType).attr("checked",!0),i.vehicleLicense===!1&&($("#is_lic").attr("checked",!i[s]),$(".get_photo").addClass("no_lic"),$("#outfile").hide()),null!=i.clearVin?$('input[name="clearVin"][value="'+i.clearVin+'"]').attr("checked",!0):$('input[name="clearVin"][value="true"]').attr("checked",!0),$("#displayMileage").val(i.displayMileage),i.clearDisplayMileage===!1&&($("#no_mile").attr("checked",!0),$("#displayMileage").parents("li").hide());for(var s in i)if(""!=i[s]&&null!=i[s])if("sweptVolume"==s)$("#sweptVolume").val(i[s].toFixed(2));else if("clearVin"==s)$('input[name="'+s+'"][value="'+i[s]+'"]').attr("checked",!0);else if("producedYears"==s)$("#"+s).val(i[s].substring(0,4)+"-"+i[s].substring(4,6)),$("#registerLicenseYears").prop("min",i[s].substring(0,4)+"-"+i[s].substring(4,6));else if("registerLicenseYears"==s)$("#"+s).val(i[s].substring(0,4)+"-"+i[s].substring(4,6));else if("featureItemList"==s)i[s].length&&($(".base_config").addClass("has_config"),$.each(i[s],function(e,t){$(".base_config ul").append('<li  data-val="'+t+'" data-type="base" class="item"><a data-val="'+t+'"  data-type="base" class="config_item base_selected selected" href="javascript:void(0)"><span>'+t+"</span></a></li>")}));else if("personalFeatureItemList"==s)i[s].length&&($(".private_config").addClass("has_config"),$.each(i[s],function(e,t){$(".private_config ul").append('<li  data-val="'+t+'" data-type="private" class="item"><a data-val="'+t+'"  data-type="private" class="config_item private_selected selected" href="javascript:void(0)"><span>'+t+"</span></a></li>")}));else{if($("#"+s).val(i[s]),"registerProvince"==s){var n=$("#"+s).find("option:selected").data("id");$.each(a[n].cityList,function(e,t){return $("#registerCity").prop("disabled",!1).append('<option class="city_opt" data-lic="'+t.license+'" value="'+t.city+'">'+t.city+"</option>"),-1!=i[s].indexOf("市")?!1:void 0})}if("currentProvince"==s){var n=$("#"+s).find("option:selected").data("id");$.each(t[n].cityList,function(e,t){$("#currentCity").prop("disabled",!1).append('<option class="city_opt" value="'+t+'">'+t+"</option>")})}}})}function b(){e.call(X.getVehicleFeaturePort,{},function(e){$(".config").each(function(t){var a=$(this).data("type");$.each(e.data,function(e,t){var i=$('<li data-val="'+t.featureColumnText+'" data-type="'+a+'" data-id="'+t.id+'" class="item"><a data-val="'+t.featureColumnText+'" data-id="'+t.id+'" data-type="'+a+'" class="config_item '+a+"_"+t.id+'" href="javascript:void(0)"><span>'+t.featureColumnText+"</span></a></li>");$("#"+a+"_config ul").append(i)})}),Z=d("#base_config"),ee=d("#private_config"),C(),oe=!1})}function w(){e.call(X.getbrandSeriesPort,{},function(e){var t=e.data;$.each(t,function(e,t){var a=0==e?"curr":"",i=t.manufacturerList,s="<ul>";$("#brand ul").append('<li data-sid="'+t.sid+'" class="l_brand '+a+'">'+t.name+"</li>"),$.each(i,function(e,t){var a=t.seriesList;s+='<li class="manufacturer" data-sid="'+t.sid+'">'+t.name+"</li>",$.each(a,function(e,t){s+='<li class="item" data-sid="'+t.sid+'">'+t.name+"</li>"})}),s+="</ul>",$("#series_item").append(s)}),d("#brand"),ie=d("#series"),ne=!1})}function C(){$(".outConfig .config_item").length&&$(".outConfig").each(function(){var e=$(this).data("type");$(this).find(".selected").each(function(){var t=$(this).data("type"),a="base"==t?"private":"base",i=$(this).data("val");$("#"+e+"_config").find('li[data-val="'+i+'"]').find(".config_item").addClass(e+"_selected selected"),$("#"+a+"_config").find('li[data-val="'+i+'"]').hide()})})}function k(e,t){$e.css({width:e+20,height:t+20}).photoClip({width:e,height:t,file:"#outfile,#file,.file",view:"#view",ok:"#clipBtn",loadStart:function(){pe.show()},loadComplete:function(){$("#take_photo_layer").addClass("show_layer").find(".layer_content").show(),$("body").css("position","fixed"),pe.hide(),$e.show(),$(le).hide(),he.hide(),ve.hide(),fe.show(),$(".img_step1,.text1").show(),$(".img_step2,.text2").hide(),$(".steps").removeClass("done"),$(".steps").removeClass("curr"),$(".step1").addClass("curr"),$(".car_photo").length&&$(".control").show()},clipFinish:function(a){ce=new Image,ce.src=a,he.hide(),ve.show(),$(".img_step1,.text1").hide(),$(".img_step2,.text2").show(),$(".step2").addClass("curr").prevAll().addClass("done").removeClass("curr"),$(".car_photo").length&&$(".control").hide(),ce.onload=function(){$e.hide(),fe.hide(),re.drawImage(ce,0,0,e,t),$(le).css({display:"block"})}}})}function S(e){function t(e){if(e.preventDefault(),n){var t=s(e);o.lineTo(t.x,t.y),o.lineWidth=10,o.shadowColor="#CC0000",o.strokeStyle="#CC0000",o.shadowBlur=1,o.stroke()}}function a(e){he.show(),e.preventDefault(),o.beginPath();var t=s(e);o.moveTo(t.x,t.y),$(".step3").addClass("curr").siblings().removeClass("curr"),$(".step1,.step2").addClass("done"),n=!0}function i(e){e.preventDefault(),n=!1}function s(e){var t,a;return h(e)?(t=e.touches[0].pageX-(j-l)/2,a=e.touches[0].pageY-$("#canvas").offset().top):(t=e.layerX,a=e.layerY),{x:t,y:a}}var n=!1,o=e.getContext("2d");e.addEventListener("mousemove",t,!1),e.addEventListener("mousedown",a,!1),e.addEventListener("mouseup",i,!1),e.addEventListener("touchstart",a,!1),e.addEventListener("touchmove",t,!1),e.addEventListener("touchend",i,!1);var l=$("#get_photo").width()}function I(){$(".photo-clip-rotateLayer").empty(),re.clearRect(0,0,ge,_e),$e.show(),ue.show(),fe.show(),ve.hide(),he.hide(),$(".steps").removeClass("curr"),$(".steps").removeClass("done"),$(".img_step1,.text1").show(),$(".img_step2,.text2").hide(),$(le).hide(),$(".car_photo").length&&$(".control").show(),T()}function P(t,a){if($(le).is(":hidden"))return void alert("请截取图片");$("#take_photo_layer").removeClass("show_layer");var i=q(le);if(i.className="finalImg",i.width=t,i.height=a,i.setAttribute("data-status","1"),de.find(".finalImg").remove().end().append(i),$(".step3").removeClass("curr"),$("#vehicleLicenseUrl").length)$("#vehicleLicenseUrl").val(canvas.toDataURL("image/jpeg"));else{var s={};s.starPhotoList=[],s.starPhotoList.push({configId:de.attr("data-id"),photoUrl:de.find("img.finalImg").attr("src")}),sessionStorage.vehicleId&&(s.id=sessionStorage.vehicleId),sessionStorage.appraiserId&&(s.appraiserId=sessionStorage.appraiserId),e.call(X.savePhotoStarsPort,{param:JSON.stringify(s),type:"POST"},function(e){e.success?sessionStorage.vehicleId=e.data:alert(e.msg)})}I(),$("body").css("position",""),$("#take_photo_layer .layer_content").hide(),document.removeEventListener("touchmove",L),$(".car_photo").length&&($("body").css({overflow:"",position:""}),$(document).scrollTop(photoScrollTop))}function x(){$("body").css("overflow","hidden")}function L(e){e.preventDefault()}function T(){$("body").css("overflow","")}function q(e){var t=new Image;return t.src=e.toDataURL("image/jpeg"),t}var Y=location.host,E="http://eqs.autostreets.com",V=$(".loading");if("mwap.com"==Y)var N="http://mwap.com/src/html/eqs";else var N=E+"/html";var B="http://images.autostreets.com/",j=document.documentElement.clientWidth||document.body.clientWidth,A=document.documentElement.clientHeight||document.body.clientHeight,X=X||{};X.userEqsListPort=E+"/m/usereqs/list",X.vinPort=E+"/m/vin/selectVehicleInfoListByVin",X.baseInfoParamPort=E+"/m/eqs/getBaseInfoParam",X.getBaseInfoPort=E+"/m/eqs/getBaseInfo",X.getByLicensePort=E+"/m/eqs/getByLicense",X.getLicensePort=E+"/m/eqs/getLicense",X.getLocationPort=E+"/m/eqs/getLocation",X.getCheckResultPort=E+"/m/eqs/getCheckResult",X.saveBaseInfoPort=E+"/m/eqs/saveBaseInfo",X.getbrandSeriesPort=E+"/m/eqs/getbrandSeries",X.improveGranulesPort=E+"/m/eqs/improveGranules",X.getVehicleFeaturePort=E+"/m/eqs/getVehicleFeature",X.getVehicleAccessoryParamPort=E+"/m/eqs/getVehicleAccessoryParam",X.delPort=E+"/m/eqs/del",X.uploadPort=E+"/m/eqs/upload",X.getVehicleAccessoryPort=E+"/m/eqs/getVehicleAccessory",X.getVehiclePhotoParamPort=E+"/m/eqs/getVehiclePhotoParam",X.getPhotoStarsPort=E+"/m/eqs/getPhotoStars",X.savePhotoStarsPort=E+"/m/eqs/savePhotoStars";var M;if($(".detection_list").length){if(!sessionStorage.appraiserId)return void r({content:"当前浏览器版本过低，推荐使用QQ浏览器！",btnYes:{text:"好的",url:"javascript:void(0)",callback:function(){window.location.href=N+"/login.html"}}});var O,R=1,D=1,U=1,F=1,Q=1;M=!0,s({searchAuditedStatusByEQS:99}),$(".top_filter").delegate("span","click",function(){O=$(this).data("code"),$(this).addClass("curr").siblings().removeClass("curr"),$("#detection_list_"+O).show().siblings(".item").hide(),R=1,D=1,U=1,F=1,Q=1,$("#detection_list_"+O).empty(),s({searchAuditedStatusByEQS:O})});var W=$("#searchIpt"),H=$("#search_submit"),G=$("#clean_search_word"),K=$(".detection_list"),z=$("#detection_list_s"),J=$("#filter_type");$("#search_light").on("click",function(){O="s",$("#top_filter_wrap").hide(),K.hide(),z.show(),$("#search").show(),$("#wrapper").addClass("searching"),$(".sub_opt").hide(),x()}),$("#closeSearch").click(function(){o()}),$("#search_form").submit(function(){var e=J.val(),t=W.val(),a={};return Q=1,"0"==e?alert("请选择查询条件"):(z.empty(),a[e]=t,s(a),W.blur(),H.hide(),G.hide(),W.removeClass("focus"),T(event)),!1}),W.focus(function(){H.show(),z.show(),0!=W.val().length&&G.show(),W.addClass("focus")}).keyup(function(){G.show(),0==W.val().length&&G.hide()}),G.click(function(){W.val(""),this.style.display="none"}),$("#addCar").click(function(){sessionStorage.vehicleId="",sessionStorage.status=100}),$("#filter_type").change(function(){$(this).val()&&H.show()}),window.onscroll=function(){var e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.scrollHeight||document.body.scrollHeight;if(e+A+150>=t&&M){var a={};"number"!=typeof O?(O="s",a[J.val()]=W.val()):a.searchAuditedStatusByEQS=O,a.current=n(O),$("#detection_list_"+O).find("li").length<$("#detection_list_"+O).data("length")&&s(a)}}}$(".layer_close").click(function(){u()});var Z,ee,te,ae,ie,se="ontouchend"in document?!0:!1,ne=!0,oe=!0,le=document.getElementById("canvas");if(le)var re=le.getContext("2d");var ce,de,pe=$(".img_loading"),ue=$("#uploadBtn"),he=$("#restore"),ve=$("#save_photo"),fe=$("#clipBtn"),$e=$("#clipArea");if($(".base_info").length){document.querySelector(".goBack").addEventListener("click",c),m(),$("#producedYears").change(function(){var e=Number($("#producedYears").val().replace("-","")),t=Number($("#registerLicenseYears").val().replace("-",""));e>t&&$("#registerLicenseYears").val(""),$("#registerLicenseYears").prop("min",$("#producedYears").val())}),$("#registerLicenseYears").change(function(){var e=Number($("#producedYears").val().replace("-","")),t=Number($("#registerLicenseYears").val().replace("-",""));e&&e>t&&$("#registerLicenseYears").val(""),$("#registerLicenseYears").prop("min",$("#producedYears").val())}),$(".no_mile").click(function(){$("#no_mile")[0].checked?$("#displayMileage").parents("li").hide():$("#displayMileage").parents("li").show(),$(".miles").val("")}),$("#is_lic").click(function(){this.checked?($(this).val("false"),$(".get_photo").addClass("no_lic"),$("#vehicleLicenseUrl").val(""),$(".finalImg").hide(),$(le).hide(),$e.show(),he.hide(),ve.hide(),re.clearRect(0,0,ge,_e),$("#outfile").hide()):($(this).val("true"),$(".finalImg").show(),$(".get_photo").removeClass("no_lic"),$("#outfile").show())}),$(".add_new_info").click(function(){oe&&b();var e=$(".add_new_info").index($(this));$(".config_tab").eq(e).addClass("curr").siblings().removeClass("curr"),$(".config").eq(e).show().siblings(".config").hide(),x(),$("#config_layer").addClass("show_layer"),$(".outConfig").each(function(){var e=$(this).data("type");$("#"+e+"_config").find(".item").show(),$("#"+e+"_config").find(".config_item").removeClass(""+e+"_selected selected")}),C(),Z&&Z.refresh(),ee&&ee.refresh()}),p(".config_tab",".config",function(e){Z.refresh(),ee.refresh()}),$("#save_config").click(function(){$(".config").each(function(){var e=$(this).data("type");$("."+e+"_selected").length?($("."+e+"_config").find("ul").empty().append($("."+e+"_selected").parent().clone()),$("."+e+"_config").find("li").length?$("."+e+"_config").addClass("has_config"):$("."+e+"_config").removeClass("has_config")):($("."+e+"_config").find("ul").empty().removeClass("has_config"),$("."+e+"_config").removeClass("has_config"))}),$(".layer").removeClass("show_layer"),T()}),$("#get_brand").click(function(){$("#brand_layer").addClass("show_layer"),ne&&w(),x()}),$("#brand").delegate("li","tap",function(){var e=$(this).index();$(this).addClass("curr").siblings().removeClass("curr"),$("#series_item ul").eq(e).show().siblings().hide(),ie.refresh(),ie.scrollTo(0,0,0,IScroll.utils.ease.quadratic)}),$("#series_item").delegate(".item","tap",function(){var e=$(this).parent(),t=e.index(),a=$(".l_brand").eq(t).html(),i=e.find(".manufacturer").html(),s=$(this).html();$("#brand_val").html(a+" "+i+" "+s),$('input[name="brand"]').val(a),$('input[name="manufacturer"]').val(i),$('input[name="brandSeries"]').val(s),$('input[name="vehicleModel"]').val(""),$('input[name="selledName"]').val(""),u()}),$(".outConfig").delegate(".config_item","click",function(){var e=$(this).data("type");$(this).toggleClass(e+"_selected selected")}),$(".config").delegate("a","tap",function(){var e=$(this).data("type"),t=$(this).data("id"),a="base"==e?"private":"base";$(this).toggleClass(e+"_selected selected"),$(this).hasClass("selected")?$("#"+a+"_config li[data-id="+t+"]").hide():$("#"+a+"_config li[data-id="+t+"]").show()});var me;$("#query").click(function(){var e=$.trim($(".vin_code").val());e?me!=e?(me=e,f(e)):$("#vin_layer").addClass("show_layer"):alert("请输入VIN码")}),$("#car_list").delegate(".select_car","click",function(){var e=$(this).data("brand"),t=$(this).data("manufacturer"),a=$(this).data("brandseries"),i=$(this).data("car"),s=$(this).data("sellname"),n=$(this).data("vehiclemodel"),o=""!=$(this).data("featureitems")&&$(this).data("featureitems").split(","),l=$(this).data("levelid");$("#brand_val").html(i),$(".carType").val(s),$('input[name="brand"]').val(e),$('input[name="manufacturer"]').val(t),$('input[name="brandSeries"]').val(a),$('input[name="vehicleModel"]').val(n),$('input[name="levelId"]').val(l),$("#sweptVolume").val($(this).data("sweptvolume")),$("#power").val($(this).data("maxpower")),"自然吸气"==$(this).data("airtype")?$("#v_l").attr("checked",!0):$("#v_t").attr("checked",!0),$("#producedYears").val($(this).data("producedyear")+"-02"),$("#transmissionType").val($(this).data("transmissiontype")),$("#oilType").val($(this).data("oiltype")),o.length&&$(".base_config").addClass("has_config").find("ul").empty()&&$.each(o,function(e,t){$(".base_config ul").append('<li data-val="'+t+'" data-type="base" class="item"><a data-val="'+t+'" data-type="base" class="config_item base_0 base_selected selected" href="javascript:void(0)"><span>'+t+"</span></a></li>")}),u()});var ge=$("#get_photo").width(),_e=$("#get_photo").height();$(le).prop({width:ge,height:_e}),$("#outfile").click(function(e){de=$("#get_photo")}),$("#take_photo_layer .layer_close").click(function(){$("body").css("position",""),$("#take_photo_layer .layer_content").hide()}),k(ge,_e),S(le),he.click(function(){re.clearRect(0,0,ge,_e),re.drawImage(ce,0,0,ge,_e),$(le).css({display:"block"}),$(this).hide(),$(".step3").removeClass("curr")}),$(".layer_close").click(function(){I()}),$("#save_photo").click(function(){P(ge,_e)})}if($(".car_photo").length&&e.call(X.getVehiclePhotoParamPort,{},function(t){var a=t.data;$.each(a,function(e,t){$("#wrapper").append('<div class="hd">'+t.photoDesc+'</div><div class="item"><div class="photo"  data-id="'+t.id+'" id="photo_'+t.id+'"> <span class="add_btn"><strong>+点击添加</strong></span><input type="file" accept="image/*" class="file"><img src="'+B+t.photoUrl+'" alt="" class="img_holder"/></div></div>')}),sessionStorage.vehicleId&&e.call(X.getPhotoStarsPort,{vehicleId:sessionStorage.vehicleId},function(e){var t=e.data;$.each(t,function(e,t){$("#photo_"+t.configId).append('<img src="'+B+t.photoUrl+'" class="finalImg"/>')})});var i=$(".photo").width(),s=$(".photo").height();$(le).prop({width:i,height:s}),$(".photo").click(function(){photoScrollTop=document.documentElement.scrollTop||document.body.scrollTop,de=$(this),$("#take_photo_layer .layer_content").show()}),k(i,s),$(".layer_close").click(function(){I(),$(".layer").removeClass("show_photo_layer").css("top","100%"),setTimeout(function(){$(".layer").css("top","")},300),$("#take_photo_layer .layer_content").hide(),$("body").css({overflow:"",position:""}),$(".step3").removeClass("curr"),$(document).scrollTop(photoScrollTop)}),$("#save_photo").click(function(){P(i,s)})}),$(".car_info").length){var ye=!0;sessionStorage.vehicleId?e.call(X.improveGranulesPort,{vehicleId:sessionStorage.vehicleId},function(t){var a=t.data;for(var i in a)a[i]?$("."+i).html('<span class="status_icon"></span>'):($("."+i).html('<span class="status_icon warn">未完善必填项</span>'),ye=!1);$(".view_report").addClass("enable"),$(".view_report").prop("href","sec_hand_check.html"),e.call(X.getCheckResultPort,{vehicleId:sessionStorage.vehicleId},function(e){e.data.del&&$(".delete").addClass("enable"),e.data.upload&&$(".upload").addClass("enable")})}):($(".view_report").prop("href","javascript:void(0)"),$(".status").html("请完善车辆信息")),$(".delete").click(function(){$(this).hasClass("enable")&&r({content:"是否删除该车辆",btnNo:{text:"取消",url:"javascript:void(0)"},btnYes:{text:"删除",url:"javascript:void(0)",callback:function(){e.call(X.delPort,{vehicleId:sessionStorage.vehicleId},function(e){e.success?window.location.href=N+"/my_detection.html":alert(e.msg)})}}})}),$(".upload").click(function(){$(this).hasClass("enable")&&e.call(X.uploadPort,{vehicleId:sessionStorage.vehicleId},function(e){e.success?(alert("上传成功"),window.location.href=N+"/my_detection.html"):alert(e.msg)})})}if($(".accessory").length){document.querySelector(".goBack").addEventListener("click",c),e.call(X.getVehicleAccessoryParamPort,{},function(t){function a(e,t){return"accessory_option_default"==e?' <label for="config_'+t+'_1"><input  value="有" class="config_'+t+'"  data-type="list" id="config_'+t+'_1" type="radio" name="'+t+'"/><span>有</span></label><label for="config_'+t+'_2"><input value="未见" class="config_'+t+'" id="config_'+t+'_2" type="radio"  data-type="list" name="'+t+'"/><span>未见</span></label>':"accessory_option_damage"==e?' <label for="config_'+t+'_1"><input value="损伤" class="config_'+t+'"  data-type="list" id="config_'+t+'_1" type="radio" name="'+t+'"/><span>损伤</span></label><label for="config_'+t+'_2"><input value="有" class="config_'+t+'" data-type="list" id="config_'+t+'_2" type="radio" name="'+t+'"/><span>有</span></label><label for="config_'+t+'_3"><input  value="未见" class="config_'+t+'" data-type="list" id="config_'+t+'_3" type="radio" name="'+t+'"/><span>未见</span></label>':void 0}var i,s=t.data.accessoryConfig;$.each(s,function(e,t){i="accessory_option_damage"==t.optionCategory?"threeRadio":"",$("#accessoryConfig").append('<li><div class="item"><label class="field"><span>'+t.accessoryName+'</span></label><div class="content"><p class="radio_box" id="'+i+'">'+a(t.optionCategory,t.id)+"</p></div></div></li>")}),sessionStorage.vehicleId?e.call(X.getVehicleAccessoryPort,{vehicleId:sessionStorage.vehicleId},function(e){var t=e.data,a=t.accessoryList;for(var i in t)null!=t[i]?($('input[name="'+i+'"][value="'+t[i]+'"]').prop("checked","checked"),"nextAnnualExamination"==i&&$("#nextAnnualExamination").val(t[i].split(" ")[0]),"nextCompulsoryInsurance"==i&&$("#nextCompulsoryInsurance").val(t[i].split(" ")[0]),"annexKey"==i&&$("#annexKey").val(t[i]),"transferNumber"==i&&$("#transferNumber").val(t[i]),"accessoryRemark"==i&&($("#accessoryRemark").val(t[i]),$(".str_count span").html($("#accessoryRemark").val().length))):($('input[name="'+i+'"][value="true"]').prop("checked","checked"),$('input[name="'+i+'"][value="非营运"]').prop("checked","checked"));$("#accessoryConfig li").each(function(){"备胎"==$(this).find(".field span").html()?$(this).find(".content label").eq(1).find("input").prop("checked",!0):$(this).find(".content label").first().find("input").prop("checked",!0)}),$.each(a,function(e,t){$(".config_"+t.accessoryConfigId+'[value="'+t.optionSelected+'"]').prop("checked","checked")})}):($("#n_tran,#y_tax,#y_cz").prop("checked",!0),$("#accessoryConfig li").each(function(){"备胎"==$(this).find(".field span").html()?$(this).find(".content label").eq(1).find("input").prop("checked",!0):$(this).find(".content label").first().find("input").prop("checked",!0)}))});var be="input";-1!=navigator.userAgent.indexOf("MSIE")&&(be="propertychange"),$("#accessoryRemark").bind(be,function(){var e=$(this).val().length;101!=e&&$(".str_count span").html(e)})}});