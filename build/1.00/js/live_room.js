/*
 * Build by xuelei.kong@autostreets.com
 * Date: 2016-04-07 10:30:42
 * Version: 1.00
 */
function touchScroll(t){if("ontouchstart"in document){var e=(document.getElementById(t),0);document.getElementById(t).addEventListener("touchstart",function(t){e=this.scrollTop+t.touches[0].pageY},!1),document.getElementById(t).addEventListener("touchmove",function(t){this.scrollTop=e-t.touches[0].pageY},!1)}}function preventScroll(t){t.preventDefault()}var car={},avStatus=1,auctionAgain=!0,siteurl="http://wap.autostreets.com/html/",imgurl="http://images.autostreets.com/";$(function(){function t(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(e);return null!=i?i[2]:null}function e(){$.ajax({url:o,type:"GET",dataType:"jsonp",jsonp:"jsoncallback",scriptCharset:"GBK",jsonpCallback:"getCurrentInfo",cache:!1,success:function(t){function e(t){return t=10>t?"00"+t:"0"+t}var i=t.data;if(console.log(i),"av"==i.source,1==avStatus){car.avid=i.auctionVehicleSid,car.vehicleSid=i.vehicleSid,car.firstPhotoUrl=i.firstPhotoUrl,car.plusRange=i.plusRange,car.videoUrl=i.plusRange,car.vehicleDesc=i.vehicleDesc,car.licenseCode=i.licenseCode,car.startPrice=i.startPrice,$(".highest").css("visibility","hidden");var n=i.auctionVehicleOrder<100?e(i.auctionVehicleOrder):i.auctionVehicleOrder;$("#thelist").empty().append('<li><img src="'+imgurl+car.firstPhotoUrl+'"></li>'),$(".auction_num").html(n),r(i.startPrice),$("#wrapper").width(a),$("#thelist li").width(a),$("#scroller").width(a*$("#thelist li").length);var o;o=new iScroll("wrapper",{snap:!0,momentum:!1,hScrollbar:!1,fixedScrollbar:!0,onBeforeScrollStart:function(t){t.preventDefault()},onScrollEnd:function(){}})}else 5==avStatus&&(car.plusRange=i.plusRange)}})}function i(t){var e=1*h.html().replace(/,/g,"");"plus"==t?e+=car.plusRange:e-=car.plusRange,l>=e||e<car.startPrice||r(e)}function r(t){for(var e=[],i=t.toString(),r=i.length-1;r>-1;r--)e.push(i[r]);for(var r=0;r<e.length;r++)(r+1)%3==0&&r+1!=e.length&&(e[r]=","+e[r]);$(".price").html(e.reverse().join(""))}function n(){$.ajax({type:"GET",url:"http://wap.autostreets.com/auction/showCurrentAuctionWithFixPrice",data:{memberSid:p,auctionSid:localStorage.id},dataType:"json",success:function(t){function i(t){$.each(t,function(t,e){$(".auction_flow ul").append("<li>"+new Date(e.bidTimestamp).toTimeString().replace("GMT+0800 (中国标准时间)","").replace("GMT+0800 (CST)","")+"  "+e.content+"</li>")})}var n=t.data;avStatus=n.avStatus,l=n.currentPrice,u=n.myBidPrice,$(".auction_flow ul").empty();var o=n.avSid;o!=car.avid&&e(),"5"==n.avStatus?m.isSpCertMerchant?(s.addClass("bid_not_allow").find("a").css("cursor","pointer"),$(".plus").addClass("disable"),$(".minus").addClass("disable")):m.isCertMerchant?(u>=l&&"0"!=$(".curr_price").html()?($(".highest").css("visibility","visible"),s.addClass("bid_not_allow").find("a").css("cursor","default")):($(".highest").css("visibility","hidden"),s.removeClass("bid_not_allow").find("a").css("cursor","pointer")),auctionAgain=!0):(clearInterval(v),$(".price_box,.auction_flow").remove(),$(".bid_box").css("position","relative").html('<div class="not_merchant"><p>该车成交价只有认证商户可见</p><p>您可以拨打客服热线<a href="tel:4008218889">400-821-8889</a></p><p>申请成为商家用户</p></div>')):"1"==n.avStatus&&auctionAgain?(e(),auctionAgain=!1):s.addClass("bid_not_allow").find("a").css("cursor","default"),n.bidActive||s.addClass("bid_not_allow").find("a").css("cursor","default"),n.seconds>=0?$(".count_down").show().html(n.seconds):$(".count_down").hide().html(""),$(".curr_price").html(l),$(".price_box .my_bid").html(u),l>=1*h.html().replace(/,/g,"")&&"0"!=$(".curr_price").html()&&r(l+car.plusRange),0!=l&&"5"==n.avStatus&&l+car.plusRange>1*h.html().replace(/,/g,"")&&r(l+car.plusRange),i(n.bidList),$(".auction_flow ul li").first().css("color","#D80000"),e()}})}var o="http://wap.autostreets.com/auction/showCurrentAuctionInfo&auctionSid="+t("id"),a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,$(".bid_btn"));s.addClass("bid_not_allow").find("a").css("cursor","default");var c=!1;e();var l,u,h=$(".price"),d=!0,p=("0"==$(".curr_price").html()?!0:!1,sessionStorage.memberSid),f=function(t){var e=sessionStorage.getItem(t),i={};try{e&&(i=JSON.parse(e))}catch(r){console.log(r.message)}return i},m=f("member_info");n();var v=setInterval(n,1e3);$(".plus").click(function(){$(this).hasClass("disable")||(i.call(this,"plus"),d=!1)}),$(".minus").click(function(){$(this).hasClass("disable")||(i.call(this,"minus"),d=!1)}),$(".fee_info").click(function(){return window.location.href=siteurl+"charge_detail.html?id="+car.avid,!1}),$(".car_detail_btn").click(function(){return c||(window.location.href=siteurl+"competitive_detail_info.html?vehicleSid="+car.vehicleSid),!1}),$(document).click(function(){$(".pop_menu").hide()}),$(".pop_menu").click(function(t){t.stopPropagation()}),$(".top_menu").click(function(t){$(".pop_menu").toggle(),t.stopPropagation()})});var validate={input:function(t,e){return""!=t.val()?!0:($(".error_txt").text(e),void this.show())},price:function(t,e,i){if(""==t.val())$(".error_txt").text(e),this.show();else{if(this.isDigital(t.val()))return!0;$(".error_txt").text(i),this.show()}},mobile:function(t,e,i){if(""==t.val())$(".error_txt").text(e),this.show();else{if(this.isMobile(t.val()))return!0;$(".error_txt").text(i),this.show()}},mail:function(t,e,i){if(""==t.val())$(".error_txt").text(e),this.show();else{if(this.isEmail(t.val()))return!0;$(".error_txt").text(i),this.show()}},password:function(t,e,i){if(""==t.val())$(".error_txt").text(e),this.show();else{if(this.isPassword(t.val()))return!0;$(".error_txt").text(i),this.show()}},same:function(t,e,i){return t.val()==e.val()?!0:($(".error_txt").text(i),void this.show())},select:function(t,e,i){return t!=e?!0:($(".error_txt").text(i),void this.show())},isDigital:function(t){var e=/^\d+(\.\d+)?$/;return e.exec(t)?!0:!1},isMobile:function(t){var e=/^0?(13[0-9]|15[0-9]|18[0-9]|14[0-9]|17[0-9])[0-9]{8}$/;return e.exec(t)?!0:!1},isEmail:function(t){var e=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return e.exec(t)?!0:!1},isPassword:function(t){var e=/^[a-zA-z0-9]{6,}$/g;return e.exec(t)?!0:!1},show:function(){$(window).scrollTop();$(".error_layer").css("position","fixed").show(),$(".tipbg").show()},hide:function(){$(".correct").click(function(){$(".error_layer").hide(),$(".tipbg").hide()})},init:function(){this.hide()}};validate.init(),Date.prototype.Format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in e)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[i]:("00"+e[i]).substr((""+e[i]).length)));return t};