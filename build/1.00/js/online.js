/*
 * Build by xuelei.kong@autostreets.com
 * Date: 2016-04-07 10:30:42
 * Version: 1.00
 */
function loadpro(){var e=$("#type-1 a").html();"全部城市"==e&&(e="");var t=$("#type-2 a").attr("selecetval");("0"==t||null==t)&&(t="");var o=$("#type-3 a").attr("selecetval");("0"==o||null==o)&&(o="");var a=url+"&city="+e+"&dateFlag="+t+"&status="+o+"&current="+page;$.ajax({type:"GET",url:a,dataType:"jsonp",jsonp:"jsoncallback",scriptCharset:"GBK",jsonpCallback:"getlist1",cache:!1,beforeSend:function(){loadingImg.show()},success:function(e){e.data.length>0?(1==page&&$("#competitive_list").empty(),$.each(e.data,function(e,t){console.log(t);var o=t.startPrice;o=memberInfo.isSpCertMerchant||memberInfo.isCertMerchant?100>o?"&yen; "+o+"元起拍":"&yen; "+o/1e4+"万元起拍":"价格仅认证商户";var a=(t.status,t.statusDesc),i=t.activity?"<li><img src='http://img.autostreetscdn.com/m/build/1.00/images/online_act.png' class='act_png'>":"<li>",n=$(i+"<span class='prolist_img'><img src='"+imgurl+t.vehicle.firstPhotoUrl+"'></span><div class='r_box'><h3>"+t.vehicle.brand+" "+t.vehicle.vehicleModel+" "+t.vehicle.selledName+"</h3><p>"+t.city+"<ins>|</ins>"+new Date(t.vehicle.registerLicenseDate).Format("yyyy年M月")+"<ins>|</ins>"+t.vehicle.displayMileage+"万公里<ins>|</ins>"+t.vehicle.licenseCode+"</p><p class='list-status'>"+a+"</p><span class='endtime'>结束时间："+new Date(t.planEndTime).Format("M-d hh:mm")+"</span><strong>"+o+"</strong></div></li>");n.click(function(){window.location.href=siteurl+"online_detail.html?id="+t.sid}),$("#competitive_list").append(n)}),power="0"):($("#loading").hide(),1==page&&($("#competitive_list").empty(),$("#competitive_list").append("<li class='nodata'>抱歉，没有符合条件的车辆</li>"))),loadingImg.hide()}}),releaseScroll()}function preventScroll(e){e.preventDefault()}function releaseScroll(e){document.body.removeEventListener("touchmove",preventScroll),$("body").css({position:"",width:""})}function touchScroll(e){if("ontouchstart"in document){var t=(document.getElementById(e),0);document.getElementById(e).addEventListener("touchstart",function(e){t=this.scrollTop+e.touches[0].pageY},!1),document.getElementById(e).addEventListener("touchmove",function(e){this.scrollTop=t-e.touches[0].pageY},!1)}}function getScrollTop(){var e=0,t=0,o=0;return document.body&&(t=document.body.scrollTop),document.documentElement&&(o=document.documentElement.scrollTop),e=t-o>0?t:o}function getScrollHeight(){var e=0,t=0,o=0;return document.body&&(t=document.body.scrollHeight),document.documentElement&&(o=document.documentElement.scrollHeight),e=t-o>0?t:o}function getWindowHeight(){var e=0;return e="CSS1Compat"==document.compatMode?document.documentElement.clientHeight:document.body.clientHeight}function fixUi(){$("body").css({position:"fixed",width:"100%"})}function controlbody(){$("#body").css("overflow",""),$("#body").css("height",""),$("html").css("height",""),$("body").css("height","")}var url="http://wap.autostreets.com/online/getOnlineAuctionList",param="http://wap.autostreets.com/online/getVehicleListParams",imgurl="http://images.autostreets.com/",caelogoimg="http://img.autostreetscdn.com/",siteurl="http://wap.autostreets.com/html/usedcar/online/",page=1,isload="0",power="0",loadingImg=$("#loading");$(function(){loadpro(),$.ajax({type:"GET",url:param,dataType:"jsonp",jsonp:"jsoncallback",scriptCharset:"GBK",jsonpCallback:"getdata",cache:!1,success:function(e){$("#typebox-1 ul").empty(),$.each(e.data.onlineCities,function(e,t){var o=t.act?"color:#f00":"",a=$("<li><a style="+o+" href='javascript:;' selecetval ='"+t.city+"'>"+t.city+"</a></li>");a.click(function(){$("#type-1 a").html($(this).children("a").attr("selecetval")),$(this).parent().parent().find("a").removeClass("on"),$(this).children("a").addClass("on"),$("#typebox-1,#tipbg").hide(),loadpro()}),$("#typebox-1 ul").append(a)}),$("#typebox-2 ul").empty(),$.each(e.data.dateFlag,function(e,t){var o=$("<li><a href='javascript:;' selecetval ='"+e+"'>"+t+"</a></li>");o.click(function(){$("#type-2 a").html($(this).children("a").html()),$("#type-2 a").attr("selecetval",$(this).children("a").attr("selecetval")),$(this).parent().parent().find("a").removeClass("on"),$(this).children("a").addClass("on"),$("#typebox-2,#tipbg").hide(),loadpro()}),$("#typebox-2 ul").append(o)}),$("#typebox-3 ul").empty(),$.each(e.data.status,function(e,t){var o=$("<li><a href='javascript:;' selecetval ='"+e+"'>"+t+"</a></li>");o.click(function(){$("#type-3 a").html($(this).children("a").html()),$("#type-3 a").attr("selecetval",$(this).children("a").attr("selecetval")),$(this).parent().parent().find("a").removeClass("on"),$(this).children("a").addClass("on"),$("#typebox-3,#tipbg").hide(),loadpro()}),$("#typebox-3 ul").append(o)})}}),$(".select-type li").click(function(){fixUi(),document.body.addEventListener("touchmove",preventScroll)}),$("#type-1").click(function(){$("#typebox-1,#typebox-2,#typebox-3").hide(),$("#typebox-1,#tipbg").show(),$("#loading").hide(),page=1}),$("#type-2").click(function(){$("#typebox-1,#typebox-2,#typebox-3").hide(),$("#typebox-2,#tipbg").show(),$("#loading").hide(),page=1}),$("#type-3").click(function(){$("#typebox-1,#typebox-2,#typebox-3").hide(),$("#typebox-3,#tipbg").show(),$("#loading").hide(),page=1}),$("#typebox-1-all").click(function(){$("#type-1 a").html($(this).html()),$(this).parent().parent().find("a").removeClass("on"),$(this).addClass("on"),$("#typebox-1,#tipbg").hide(),loadpro()}),$("#typebox-2-all").click(function(){$("#type-2 a").html($(this).html()),$("#type-2 a").attr("selecetval","0"),$(this).parent().parent().find("a").removeClass("on"),$(this).addClass("on"),$("#typebox-2,#tipbg").hide(),loadpro()}),$("#typebox-3-all").click(function(){$("#type-3 a").html($(this).html()),$("#type-3 a").attr("selecetval","0"),$(this).parent().parent().find("a").removeClass("on"),$(this).addClass("on"),$("#typebox-3,#tipbg").hide(),$("#type-3 a").attr("selecetval","0"),loadpro()})}),Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in t)new RegExp("("+o+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[o]:("00"+t[o]).substr((""+t[o]).length)));return e};var getJsonInSessionStorage=function(e){var t=sessionStorage.getItem(e),o={};try{t&&(o=JSON.parse(t))}catch(a){console.log(a.message)}return o},memberInfo=getJsonInSessionStorage("member_info");touchScroll("typebox-1"),touchScroll("typebox-2"),touchScroll("typebox-3"),$("#tipbg").click(function(){releaseScroll(),$(".select-list-box").hide(),$(this).hide(),$(".select-type li").removeClass("curr")}),window.onscroll=function(){getScrollTop()+getWindowHeight()+100>=getScrollHeight()&&"0"==power&&(page++,power="1",loadpro())};